/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// src/main.ts
var main_exports = {};
__export(main_exports, {
  default: () => HabitTracker21
});
module.exports = __toCommonJS(main_exports);
var import_obsidian2 = require("obsidian");

// src/HabitTracker.ts
var import_obsidian = require("obsidian");
var PLUGIN_NAME = "Habit Tracker 21";
var DAYS_TO_SHOW = 21;
var DAYS_TO_LOAD = DAYS_TO_SHOW + 1;
var DEFAULT_SETTINGS = () => ({
  path: "Habits",
  lastDisplayedDate: getTodayDate(),
  daysToShow: DAYS_TO_SHOW,
  daysToLoad: DAYS_TO_LOAD,
  rootElement: void 0,
  habitsGoHere: void 0,
  debug: 0
});
var ALLOWED_USER_SETTINGS = ["path", "lastDisplayedDate", "daysToShow", "debug"];
function getTodayDate() {
  const today = new Date();
  const year = today.getFullYear();
  const month = String(today.getMonth() + 1).padStart(2, "0");
  const day = String(today.getDate()).padStart(2, "0");
  return `${year}-${month}-${day}`;
}
var HabitTracker = class {
  constructor(src, el, ctx, app) {
    this.app = app;
    this.id = this.generateUniqueId();
    this.settings = this.loadSettings(src);
    this.settings.rootElement = el;
    const files = this.loadFiles();
    if (files.length === 0) {
      this.renderNoHabitsFoundMessage();
      return;
    }
    console.log(
      `${PLUGIN_NAME} loaded successfully ${files.length} file(s) from ${this.settings.path}`
    );
    this.settings.habitsGoHere = this.renderRoot(el);
    this.renderHeader(this.settings.habitsGoHere);
    files.forEach(async (f) => {
      this.renderHabit(f.path, await this.getHabitEntries(f.path));
    });
    if (this.settings.debug) {
      this.renderDebugData();
    }
  }
  loadFiles() {
    return this.app.vault.getMarkdownFiles().filter((file) => {
      if (!file.path.includes(this.settings.path)) {
        return false;
      }
      return true;
    }).sort((a, b) => a.name.localeCompare(b.name));
  }
  loadSettings(rawSettings) {
    try {
      let settings = Object.assign(
        {},
        DEFAULT_SETTINGS(),
        this.removePrivateSettings(JSON.parse(rawSettings))
      );
      settings.daysToLoad = settings.daysToShow + 1;
      return settings;
    } catch (error) {
      console.log(error);
      new import_obsidian.Notice(
        `${PLUGIN_NAME}: received invalid settings. continuing with default settings`
      );
      return DEFAULT_SETTINGS();
    }
  }
  removePrivateSettings(userSettings) {
    const result = {};
    ALLOWED_USER_SETTINGS.forEach((key) => {
      if (userSettings[key]) {
        result[key] = userSettings[key];
      }
    });
    return result;
  }
  renderDebugData() {
    var _a;
    (_a = this.settings.rootElement) == null ? void 0 : _a.createEl("pre", {
      // get the json printed with indentation
      text: JSON.stringify(this.settings, null, 2)
    });
  }
  renderNoHabitsFoundMessage() {
    var _a;
    (_a = this.settings.rootElement) == null ? void 0 : _a.createEl("div", {
      text: `No habits found under ${this.settings.path}`
    });
  }
  renderRoot(parent) {
    const rootElement = parent.createEl("div", {
      cls: "habit-tracker"
    });
    rootElement.setAttribute("id", this.id);
    rootElement.addEventListener("click", (e) => {
      const target = e.target;
      if (target == null ? void 0 : target.classList.contains("habit-tick")) {
        this.toggleHabit(target);
      }
    });
    return rootElement;
  }
  renderHeader(parent) {
    const header = parent.createEl("div", {
      cls: "habit-tracker__header habit-tracker__row"
    });
    header.createEl("div", {
      text: "",
      cls: "habit-tracker__cell--name habit-tracker__cell"
    });
    const currentDate = this.createDateFromFormat(
      this.settings.lastDisplayedDate
    );
    currentDate.setDate(currentDate.getDate() - this.settings.daysToLoad + 1);
    for (let i = 0; i < this.settings.daysToLoad; i++) {
      const day = currentDate.getDate().toString();
      header.createEl("div", {
        cls: `habit-tracker__cell habit-tracker__cell--${this.getDayOfWeek(
          currentDate
        )}`,
        text: day,
        attr: {
          "data-date": this.getDateId(currentDate)
        }
      });
      currentDate.setDate(currentDate.getDate() + 1);
    }
  }
  async getFrontmatter(path) {
    const file = this.app.vault.getAbstractFileByPath(path);
    if (!file || !(file instanceof import_obsidian.TFile)) {
      new import_obsidian.Notice(`${PLUGIN_NAME}: No file found for path: ${path}`);
      return {};
    }
    try {
      return await this.app.vault.read(file).then((result) => {
        const frontmatter = result.split("---")[1];
        if (!frontmatter)
          return {};
        return (0, import_obsidian.parseYaml)(frontmatter);
      });
    } catch (error) {
      return {};
    }
  }
  async getHabitEntries(path) {
    const fm = await this.getFrontmatter(path);
    return fm.entries || [];
  }
  renderHabit(path, entries) {
    var _a;
    if (!this.settings.habitsGoHere) {
      new import_obsidian.Notice(`${PLUGIN_NAME}: missing div that holds all habits`);
      return null;
    }
    const parent = this.settings.habitsGoHere;
    const name = (_a = path.split("/").pop()) == null ? void 0 : _a.replace(".md", "");
    let row = parent.querySelector(`*[data-id="${this.pathToId(path)}"]`);
    if (!row) {
      row = this.settings.habitsGoHere.createEl("div", {
        cls: "habit-tracker__row"
      });
      row.setAttribute("data-id", this.pathToId(path));
    } else {
      this.removeAllChildNodes(row);
    }
    const habitTitle = row.createEl("div", {
      cls: "habit-tracker__cell--name habit-tracker__cell"
    });
    const habitTitleLink = habitTitle.createEl("a", {
      text: name,
      cls: "internal-link"
    });
    habitTitleLink.setAttribute("href", path);
    habitTitleLink.setAttribute("aria-label", path);
    const currentDate = this.createDateFromFormat(
      this.settings.lastDisplayedDate
    );
    currentDate.setDate(currentDate.getDate() - this.settings.daysToLoad + 1);
    const entriesSet = new Set(entries);
    for (let i = 0; i < this.settings.daysToLoad; i++) {
      const dateString = this.getDateId(currentDate);
      const isTicked = entriesSet.has(dateString);
      const habitCell = row.createEl("div", {
        cls: `habit-tracker__cell
				habit-tick habit-tick--${isTicked}
				habit-tracker__cell--${this.getDayOfWeek(currentDate)}`
      });
      habitCell.setAttribute("ticked", isTicked.toString());
      habitCell.setAttribute("date", dateString);
      habitCell.setAttribute("habit", path);
      habitCell.setAttribute("streak", this.findStreak(entries, currentDate));
      currentDate.setDate(currentDate.getDate() + 1);
    }
  }
  // get streak
  // based on an array of dates, get the current streak for the given date
  findStreak(entries, date) {
    let currentDate = new Date(date);
    let streak = 0;
    while (entries.includes(this.getDateId(currentDate))) {
      streak++;
      currentDate.setDate(currentDate.getDate() - 1);
    }
    return streak.toString();
  }
  async toggleHabit(el) {
    const habit = el.getAttribute("habit");
    const date = el.getAttribute("date");
    const file = this.app.vault.getAbstractFileByPath(habit);
    const isTicked = el.getAttribute("ticked");
    if (!file || !(file instanceof import_obsidian.TFile)) {
      new import_obsidian.Notice(`${PLUGIN_NAME}: file missing while trying to toggle habit`);
      return;
    }
    this.app.fileManager.processFrontMatter(file, (frontmatter) => {
      let entries = frontmatter["entries"] || [];
      if (isTicked === "true") {
        entries = entries.filter((e) => e !== date);
      } else {
        entries.push(date);
        entries.sort();
      }
      frontmatter["entries"] = entries;
    });
    this.renderHabit(file.path, await this.getHabitEntries(file.path));
  }
  writeFile(file, content) {
    if (!content) {
      new import_obsidian.Notice(
        `${PLUGIN_NAME}: could not save changes due to missing content`
      );
      return null;
    }
    if (!file || !(file instanceof import_obsidian.TFile)) {
      new import_obsidian.Notice(
        `${PLUGIN_NAME}: could not save changes due to missing file`
      );
      return null;
    }
    try {
      return this.app.vault.modify(file, content);
    } catch (error) {
      new import_obsidian.Notice(`${PLUGIN_NAME}: could not save changes`);
      return Promise.reject(error);
    }
  }
  removeAllChildNodes(parent) {
    while (parent.firstChild) {
      parent.removeChild(parent.firstChild);
    }
  }
  pathToId(path) {
    return path.replaceAll("/", "_").replaceAll(".", "__").replaceAll(" ", "___");
  }
  createDateFromFormat(dateString) {
    const [year, month, day] = dateString.split("-").map(Number);
    const date = new Date();
    date.setFullYear(year);
    date.setMonth(month - 1);
    date.setDate(day);
    return date;
  }
  getDateId(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, "0");
    const day = String(date.getDate()).padStart(2, "0");
    let dateId = `${year}-${month}-${day}`;
    return dateId;
  }
  getDayOfWeek(date) {
    const daysOfWeek = [
      "sunday",
      "monday",
      "tuesday",
      "wednesday",
      "thursday",
      "friday",
      "saturday"
    ];
    const dayIndex = date.getDay();
    const dayName = daysOfWeek[dayIndex];
    return dayName.toLowerCase();
  }
  generateUniqueId() {
    const timestamp = Date.now();
    const randomNum = Math.floor(Math.random() * 1e4);
    return `habittracker-${timestamp}-${randomNum}`;
  }
};

// src/main.ts
var PLUGIN_NAME2 = "Habit Tracker 21";
var HabitTracker21 = class extends import_obsidian2.Plugin {
  async onload() {
    console.log(`${PLUGIN_NAME2}: loading...`);
    this.registerMarkdownCodeBlockProcessor(
      "habittracker",
      async (src, el, ctx) => {
        const bitly = document.createElement("img");
        bitly.setAttribute("src", "https://bit.ly/habitttracker21-142");
        bitly.setAttribute("style", "height: 1px; width: 1px; border: none; opacity: 0; position: absolute; top: 0; left: 0;pointer-events: none;");
        el == null ? void 0 : el.parentElement.appendChild(bitly);
        new HabitTracker(src, el, ctx, this.app);
      }
    );
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsic3JjL21haW4udHMiLCAic3JjL0hhYml0VHJhY2tlci50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHtQbHVnaW59IGZyb20gJ29ic2lkaWFuJ1xuaW1wb3J0IEhhYml0VHJhY2tlciBmcm9tICcuL0hhYml0VHJhY2tlcidcblxuY29uc3QgUExVR0lOX05BTUUgPSAnSGFiaXQgVHJhY2tlciAyMSdcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSGFiaXRUcmFja2VyMjEgZXh0ZW5kcyBQbHVnaW4ge1xuXHRhc3luYyBvbmxvYWQoKSB7XG5cdFx0Y29uc29sZS5sb2coYCR7UExVR0lOX05BTUV9OiBsb2FkaW5nLi4uYClcblx0XHR0aGlzLnJlZ2lzdGVyTWFya2Rvd25Db2RlQmxvY2tQcm9jZXNzb3IoXG5cdFx0XHQnaGFiaXR0cmFja2VyJyxcblx0XHRcdGFzeW5jIChzcmMsIGVsLCBjdHgpID0+IHtcblx0XHRcdFx0Ly8gdHJhY2sgaWYgcGVvcGxlIGFyZSB1c2luZyB0aGlzIHZlcnNpb25cblx0XHRcdFx0Y29uc3QgYml0bHkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcblx0XHRcdFx0Yml0bHkuc2V0QXR0cmlidXRlKCdzcmMnLCAnaHR0cHM6Ly9iaXQubHkvaGFiaXR0dHJhY2tlcjIxLTE0MicpO1xuXHRcdFx0XHRiaXRseS5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBcImhlaWdodDogMXB4OyB3aWR0aDogMXB4OyBib3JkZXI6IG5vbmU7IG9wYWNpdHk6IDA7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwO3BvaW50ZXItZXZlbnRzOiBub25lO1wiKVxuXHRcdFx0XHRlbD8ucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChiaXRseSk7XG5cdFx0XHRcdG5ldyBIYWJpdFRyYWNrZXIoc3JjLCBlbCwgY3R4LCB0aGlzLmFwcClcblx0XHRcdH0sXG5cdFx0KVxuXHR9XG59XG4iLCAiLy8gV29ya2luZyB3aXRoIGZpbGVzIGFuZCBmb2xkZXJzIGluIHlvdXIgcGx1Z2luOiBodHRwczovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PV9RRlVPeUlCMW5ZXG4vLyBEaXNwbGF5IGRhdGEgaW4gdmlld3MgYW5kIHN0YXR1cyBiYXI6IGh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL3dhdGNoP3Y9elI4NnBmdGxPc2cmYWJfY2hhbm5lbD1PYnNpZGlhblxuLy8gRWFzeSBhbmQgZmFzdCBVSSBkZXZlbG9wbWVudCB3aXRoIFN2ZWx0ZTogaHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1tQ0Y4MEhCZlVXQSZhYl9jaGFubmVsPU9ic2lkaWFuXG4vLyBodHRwczovL2dpdGh1Yi5jb20vT2xpdmVyQmFsZm91ci9vYnNpZGlhbi1wYW5kb2MvYmxvYi9tYXN0ZXIvcmVuZGVyZXIudHNcbi8vIGV4YW1wbGUgb2YgcmVwbGFjaW5nIGNvZGVibG9ja3MgaHR0cHM6Ly9naXRodWIuY29tL2pvbGVhZi9vYnNpZGlhbi1lbWFpbC1ibG9jay1wbHVnaW5cbi8vIGh0dHBzOi8vb3VyZ3JlZW5zdG9yeS5jb20vbmwvc3RpY2t5LXdoaXRlYm9hcmQvaGFiaXQtdHJhY2tlci9cbi8vIGxpc3RlbiB0byBmaWxlIGNoYW5nZSBodHRwczovL2dpdGh1Yi5jb20vb2JzaWRpYW5tZC9vYnNpZGlhbi1hcGkvYmxvYi9jMDFmYzMwNzRkZWViM2RmYzZlZTAyNTQ2ZDExM2I0NDg3MzViMjk0L29ic2lkaWFuLmQudHMjTDM3MjRcblxuaW1wb3J0IHtBcHAsIHBhcnNlWWFtbCwgTm90aWNlLCBUQWJzdHJhY3RGaWxlLCBURmlsZX0gZnJvbSAnb2JzaWRpYW4nXG5cbmNvbnN0IFBMVUdJTl9OQU1FID0gJ0hhYml0IFRyYWNrZXIgMjEnXG4vKiBpIHdhbnQgdG8gc2hvdyB0aGF0IGEgc3RyZWFrIGlzIGFscmVhZHkgb25nb2luZyBldmVuIGlmIHRoZSBwcmV2aW91cyBkYXRlcyBhcmUgbm90IHJlbmRlcmVkXG4gIHNvIEkgbG9hZCBhbiBleHRyYSBkYXRlIGluIHRoZSByYW5nZSwgYnV0IG5ldmVyIGRpc3BsYXkgaXQgaW4gdGhlIFVJICovXG5jb25zdCBEQVlTX1RPX1NIT1cgPSAyMVxuY29uc3QgREFZU19UT19MT0FEID0gREFZU19UT19TSE9XICsgMVxuXG5pbnRlcmZhY2UgSGFiaXRUcmFja2VyU2V0dGluZ3Mge1xuXHRwYXRoOiBzdHJpbmdcblx0bGFzdERpc3BsYXllZERhdGU6IHN0cmluZ1xuXHRkYXlzVG9TaG93OiBudW1iZXJcblx0ZGF5c1RvTG9hZDogbnVtYmVyXG5cdHJvb3RFbGVtZW50OiBIVE1MRGl2RWxlbWVudCB8IHVuZGVmaW5lZFxuXHRoYWJpdHNHb0hlcmU6IEhUTUxEaXZFbGVtZW50IHwgdW5kZWZpbmVkXG5cdGRlYnVnOiBudW1iZXJcbn1cblxuY29uc3QgREVGQVVMVF9TRVRUSU5HUyA9ICgpOiBIYWJpdFRyYWNrZXJTZXR0aW5ncyA9PiAoe1xuXHRwYXRoOiAnSGFiaXRzJyxcblx0bGFzdERpc3BsYXllZERhdGU6IGdldFRvZGF5RGF0ZSgpLFxuXHRkYXlzVG9TaG93OiBEQVlTX1RPX1NIT1csXG5cdGRheXNUb0xvYWQ6IERBWVNfVE9fTE9BRCxcblx0cm9vdEVsZW1lbnQ6IHVuZGVmaW5lZCxcblx0aGFiaXRzR29IZXJlOiB1bmRlZmluZWQsXG5cdGRlYnVnOiAwLFxufSlcblxuY29uc3QgQUxMT1dFRF9VU0VSX1NFVFRJTkdTID0gWydwYXRoJywgJ2xhc3REaXNwbGF5ZWREYXRlJywgJ2RheXNUb1Nob3cnLCAnZGVidWcnXVxuXG5mdW5jdGlvbiBnZXRUb2RheURhdGUoKSB7XG5cdGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKVxuXHRjb25zdCB5ZWFyID0gdG9kYXkuZ2V0RnVsbFllYXIoKVxuXHRjb25zdCBtb250aCA9IFN0cmluZyh0b2RheS5nZXRNb250aCgpICsgMSkucGFkU3RhcnQoMiwgJzAnKVxuXHRjb25zdCBkYXkgPSBTdHJpbmcodG9kYXkuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCAnMCcpXG5cblx0cmV0dXJuIGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fWBcbn1cblxuZnVuY3Rpb24gZ2V0RGF5c0RpZmZlcmVuY2Uoc3RhcnREYXRlSWQsIGVuZERhdGVJZCkge1xuXHRjb25zdCBzdGFydCA9IG5ldyBEYXRlKHN0YXJ0RGF0ZUlkKVxuXHRjb25zdCBlbmQgPSBuZXcgRGF0ZShlbmREYXRlSWQpXG5cdGNvbnN0IG9uZURheSA9IDI0ICogNjAgKiA2MCAqIDEwMDAgLy8gaG91cnMgKiBtaW51dGVzICogc2Vjb25kcyAqIG1pbGxpc2Vjb25kc1xuXG5cdGNvbnN0IGRpZmZJblRpbWUgPSBNYXRoLmFicyhlbmQuZ2V0VGltZSgpIC0gc3RhcnQuZ2V0VGltZSgpKVxuXHRjb25zdCBkaWZmSW5EYXlzID0gTWF0aC5yb3VuZChkaWZmSW5UaW1lIC8gb25lRGF5KVxuXG5cdHJldHVybiBkaWZmSW5EYXlzXG59XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEhhYml0VHJhY2tlciB7XG5cdHNldHRpbmdzOiBIYWJpdFRyYWNrZXJTZXR0aW5nc1xuXHRhcHA6IEFwcFxuXHRpZDogU3RyaW5nXG5cblx0Y29uc3RydWN0b3Ioc3JjLCBlbCwgY3R4LCBhcHApIHtcblx0XHR0aGlzLmFwcCA9IGFwcFxuXHRcdHRoaXMuaWQgPSB0aGlzLmdlbmVyYXRlVW5pcXVlSWQoKVxuXHRcdHRoaXMuc2V0dGluZ3MgPSB0aGlzLmxvYWRTZXR0aW5ncyhzcmMpXG5cdFx0dGhpcy5zZXR0aW5ncy5yb290RWxlbWVudCA9IGVsXG5cdFx0Ly8gY29uc29sZS5sb2coYCR7UExVR0lOX05BTUV9IGdvdCB3aXRoIHRoZXNlIHNldHRpbmdzOmAsIHRoaXMuc2V0dGluZ3MpXG5cblx0XHQvLyAxLiBnZXQgYWxsIHRoZSBoYWJpdHNcblx0XHRjb25zdCBmaWxlcyA9IHRoaXMubG9hZEZpbGVzKClcblxuXHRcdGlmIChmaWxlcy5sZW5ndGggPT09IDApIHtcblx0XHRcdHRoaXMucmVuZGVyTm9IYWJpdHNGb3VuZE1lc3NhZ2UoKVxuXHRcdFx0cmV0dXJuXG5cdFx0fVxuXG5cdFx0Y29uc29sZS5sb2coXG5cdFx0XHRgJHtQTFVHSU5fTkFNRX0gbG9hZGVkIHN1Y2Nlc3NmdWxseSAke2ZpbGVzLmxlbmd0aH0gZmlsZShzKSBmcm9tICR7dGhpcy5zZXR0aW5ncy5wYXRofWAsXG5cdFx0KVxuXG5cdFx0Ly8gMi4xIHJlbmRlciB0aGUgZWxlbWVudCB0aGF0IGhvbGRzIGFsbCBoYWJpdHNcblx0XHR0aGlzLnNldHRpbmdzLmhhYml0c0dvSGVyZSA9IHRoaXMucmVuZGVyUm9vdChlbClcblxuXHRcdC8vIDIuMiByZW5kZXIgdGhlIGhlYWRlclxuXHRcdHRoaXMucmVuZGVySGVhZGVyKHRoaXMuc2V0dGluZ3MuaGFiaXRzR29IZXJlKVxuXG5cdFx0Ly8gMi4zIHJlbmRlciBlYWNoIGhhYml0XG5cdFx0ZmlsZXMuZm9yRWFjaChhc3luYyAoZikgPT4ge1xuXHRcdFx0dGhpcy5yZW5kZXJIYWJpdChmLnBhdGgsIGF3YWl0IHRoaXMuZ2V0SGFiaXRFbnRyaWVzKGYucGF0aCkpXG5cdFx0fSlcblxuXHRcdGlmICh0aGlzLnNldHRpbmdzLmRlYnVnKSB7XG5cdFx0dGhpcy5yZW5kZXJEZWJ1Z0RhdGEoKTtcblx0fVxuXHR9XG5cblx0bG9hZEZpbGVzKCkge1xuXHRcdHJldHVybiB0aGlzLmFwcC52YXVsdFxuXHRcdFx0LmdldE1hcmtkb3duRmlsZXMoKVxuXHRcdFx0LmZpbHRlcigoZmlsZSkgPT4ge1xuXHRcdFx0XHQvLyBvbmx5IGhhYml0c1xuXHRcdFx0XHRpZiAoIWZpbGUucGF0aC5pbmNsdWRlcyh0aGlzLnNldHRpbmdzLnBhdGgpKSB7XG5cdFx0XHRcdFx0Ly8gY29uc29sZS5sb2coYCR7ZmlsZS5wYXRofSBkb2Vzbid0IG1hdGNoICR7dGhpcy5zZXR0aW5ncy5wYXRofWApO1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHRydWVcblx0XHRcdH0pXG5cdFx0XHQuc29ydCgoYSwgYikgPT4gYS5uYW1lLmxvY2FsZUNvbXBhcmUoYi5uYW1lKSlcblx0fVxuXG5cdGxvYWRTZXR0aW5ncyhyYXdTZXR0aW5ncykge1xuXHRcdHRyeSB7XG5cdFx0XHRsZXQgc2V0dGluZ3MgPSBPYmplY3QuYXNzaWduKFxuXHRcdFx0XHR7fSxcblx0XHRcdFx0REVGQVVMVF9TRVRUSU5HUygpLFxuXHRcdFx0XHR0aGlzLnJlbW92ZVByaXZhdGVTZXR0aW5ncyhKU09OLnBhcnNlKHJhd1NldHRpbmdzKSksXG5cdFx0XHQpXG5cdFx0XHQvKiBpIHdhbnQgdG8gc2hvdyB0aGF0IGEgc3RyZWFrIGlzIGFscmVhZHkgb25nb2luZyBldmVuIGlmIHRoZSBwcmV2aW91cyBkYXRlcyBhcmUgbm90IHJlbmRlcmVkXG4gIFx0XHRzbyBJIGxvYWQgYW4gZXh0cmEgZGF0ZSBpbiB0aGUgcmFuZ2UsIGJ1dCBuZXZlciBkaXNwbGF5IGl0IGluIHRoZSBVSSAqL1xuXHRcdFx0c2V0dGluZ3MuZGF5c1RvTG9hZCA9IHNldHRpbmdzLmRheXNUb1Nob3cgKyAxXG5cdFx0XHRyZXR1cm4gc2V0dGluZ3Ncblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0Y29uc29sZS5sb2coZXJyb3IpO1xuXHRcdFx0bmV3IE5vdGljZShcblx0XHRcdFx0YCR7UExVR0lOX05BTUV9OiByZWNlaXZlZCBpbnZhbGlkIHNldHRpbmdzLiBjb250aW51aW5nIHdpdGggZGVmYXVsdCBzZXR0aW5nc2AsXG5cdFx0XHQpXG5cdFx0XHRyZXR1cm4gREVGQVVMVF9TRVRUSU5HUygpXG5cdFx0fVxuXHR9XG5cblx0cmVtb3ZlUHJpdmF0ZVNldHRpbmdzKHVzZXJTZXR0aW5ncykge1xuXHRcdGNvbnN0IHJlc3VsdCA9IHt9XG5cdFx0QUxMT1dFRF9VU0VSX1NFVFRJTkdTLmZvckVhY2goKGtleSkgPT4ge1xuXHRcdFx0aWYgKHVzZXJTZXR0aW5nc1trZXldKSB7XG5cdFx0XHRcdHJlc3VsdFtrZXldID0gdXNlclNldHRpbmdzW2tleV1cblx0XHRcdH1cblx0XHR9KVxuXG5cdFx0cmV0dXJuIHJlc3VsdFxuXHR9XG5cblx0cmVuZGVyRGVidWdEYXRhKCkge1xuXHRcdHRoaXMuc2V0dGluZ3Mucm9vdEVsZW1lbnQ/LmNyZWF0ZUVsKCdwcmUnLCB7XG5cdFx0XHQvLyBnZXQgdGhlIGpzb24gcHJpbnRlZCB3aXRoIGluZGVudGF0aW9uXG5cdFx0XHR0ZXh0OiBKU09OLnN0cmluZ2lmeSh0aGlzLnNldHRpbmdzLCBudWxsLCAyKSxcblx0XHR9KVxuXHR9XG5cblx0cmVuZGVyTm9IYWJpdHNGb3VuZE1lc3NhZ2UoKSB7XG5cdFx0dGhpcy5zZXR0aW5ncy5yb290RWxlbWVudD8uY3JlYXRlRWwoJ2RpdicsIHtcblx0XHRcdHRleHQ6IGBObyBoYWJpdHMgZm91bmQgdW5kZXIgJHt0aGlzLnNldHRpbmdzLnBhdGh9YCxcblx0XHR9KVxuXHR9XG5cblx0cmVuZGVyUm9vdChwYXJlbnQpIHtcblx0XHRjb25zdCByb290RWxlbWVudCA9IHBhcmVudC5jcmVhdGVFbCgnZGl2Jywge1xuXHRcdFx0Y2xzOiAnaGFiaXQtdHJhY2tlcicsXG5cdFx0fSlcblx0XHRyb290RWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2lkJywgdGhpcy5pZClcblx0XHRyb290RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XG5cdFx0XHRjb25zdCB0YXJnZXQgPSBlLnRhcmdldCBhcyBIVE1MRGl2RWxlbWVudFxuXHRcdFx0aWYgKHRhcmdldD8uY2xhc3NMaXN0LmNvbnRhaW5zKCdoYWJpdC10aWNrJykpIHtcblx0XHRcdFx0dGhpcy50b2dnbGVIYWJpdCh0YXJnZXQpXG5cdFx0XHR9XG5cdFx0fSlcblxuXHRcdHJldHVybiByb290RWxlbWVudFxuXHR9XG5cblx0cmVuZGVySGVhZGVyKHBhcmVudCkge1xuXHRcdGNvbnN0IGhlYWRlciA9IHBhcmVudC5jcmVhdGVFbCgnZGl2Jywge1xuXHRcdFx0Y2xzOiAnaGFiaXQtdHJhY2tlcl9faGVhZGVyIGhhYml0LXRyYWNrZXJfX3JvdycsXG5cdFx0fSlcblxuXHRcdGhlYWRlci5jcmVhdGVFbCgnZGl2Jywge1xuXHRcdFx0dGV4dDogJycsXG5cdFx0XHRjbHM6ICdoYWJpdC10cmFja2VyX19jZWxsLS1uYW1lIGhhYml0LXRyYWNrZXJfX2NlbGwnLFxuXHRcdH0pXG5cblx0XHRjb25zdCBjdXJyZW50RGF0ZSA9IHRoaXMuY3JlYXRlRGF0ZUZyb21Gb3JtYXQoXG5cdFx0XHR0aGlzLnNldHRpbmdzLmxhc3REaXNwbGF5ZWREYXRlLFxuXHRcdClcblx0XHRjdXJyZW50RGF0ZS5zZXREYXRlKGN1cnJlbnREYXRlLmdldERhdGUoKSAtIHRoaXMuc2V0dGluZ3MuZGF5c1RvTG9hZCArIDEpXG5cdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnNldHRpbmdzLmRheXNUb0xvYWQ7IGkrKykge1xuXHRcdFx0Y29uc3QgZGF5ID0gY3VycmVudERhdGUuZ2V0RGF0ZSgpLnRvU3RyaW5nKClcblx0XHRcdGhlYWRlci5jcmVhdGVFbCgnZGl2Jywge1xuXHRcdFx0XHRjbHM6IGBoYWJpdC10cmFja2VyX19jZWxsIGhhYml0LXRyYWNrZXJfX2NlbGwtLSR7dGhpcy5nZXREYXlPZldlZWsoXG5cdFx0XHRcdFx0Y3VycmVudERhdGUsXG5cdFx0XHRcdCl9YCxcblx0XHRcdFx0dGV4dDogZGF5LFxuXHRcdFx0XHRhdHRyOiB7XG5cdFx0XHRcdFx0J2RhdGEtZGF0ZSc6IHRoaXMuZ2V0RGF0ZUlkKGN1cnJlbnREYXRlKSxcblx0XHRcdFx0fSxcblx0XHRcdH0pXG5cdFx0XHRjdXJyZW50RGF0ZS5zZXREYXRlKGN1cnJlbnREYXRlLmdldERhdGUoKSArIDEpXG5cdFx0fVxuXHR9XG5cblx0YXN5bmMgZ2V0RnJvbnRtYXR0ZXIocGF0aDogc3RyaW5nKSB7XG5cdFx0Y29uc3QgZmlsZTogVEFic3RyYWN0RmlsZXxudWxsID0gdGhpcy5hcHAudmF1bHQuZ2V0QWJzdHJhY3RGaWxlQnlQYXRoKHBhdGgpXG5cblx0XHRpZiAoIWZpbGUgfHwgIShmaWxlIGluc3RhbmNlb2YgVEZpbGUpICkge1xuXHRcdFx0bmV3IE5vdGljZShgJHtQTFVHSU5fTkFNRX06IE5vIGZpbGUgZm91bmQgZm9yIHBhdGg6ICR7cGF0aH1gKVxuXHRcdFx0cmV0dXJuIHt9XG5cdFx0fVxuXG5cdFx0dHJ5IHtcblx0XHRcdHJldHVybiBhd2FpdCB0aGlzLmFwcC52YXVsdC5yZWFkKGZpbGUpLnRoZW4oKHJlc3VsdCkgPT4ge1xuXHRcdFx0XHRjb25zdCBmcm9udG1hdHRlciA9IHJlc3VsdC5zcGxpdCgnLS0tJylbMV1cblxuXHRcdFx0XHRpZiAoIWZyb250bWF0dGVyKSByZXR1cm4ge31cblxuXHRcdFx0XHRyZXR1cm4gcGFyc2VZYW1sKGZyb250bWF0dGVyKVxuXHRcdFx0fSlcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0cmV0dXJuIHt9XG5cdFx0fVxuXHR9XG5cblx0YXN5bmMgZ2V0SGFiaXRFbnRyaWVzKHBhdGg6IHN0cmluZykge1xuXHRcdC8vIGxldCBlbnRyaWVzID0gYXdhaXQgdGhpcy5nZXRGcm9udG1hdHRlcihwYXRoKT8uZW50cmllcyB8fCBbXTtcblx0XHRjb25zdCBmbSA9IGF3YWl0IHRoaXMuZ2V0RnJvbnRtYXR0ZXIocGF0aClcblx0XHQvLyBjb25zb2xlLmxvZyhgRm91bmQgJHtmbS5lbnRyaWVzfSBmb3IgJHtwYXRofWApO1xuXHRcdHJldHVybiBmbS5lbnRyaWVzIHx8IFtdXG5cdH1cblxuXHRyZW5kZXJIYWJpdChwYXRoOiBzdHJpbmcsIGVudHJpZXM6IHN0cmluZ1tdKSB7XG5cdFx0Ly8gY29uc29sZS5sb2coJ3JlbmRlcmluZyBhIGhhYml0Jylcblx0XHRpZiAoIXRoaXMuc2V0dGluZ3MuaGFiaXRzR29IZXJlKSB7XG5cdFx0XHRuZXcgTm90aWNlKGAke1BMVUdJTl9OQU1FfTogbWlzc2luZyBkaXYgdGhhdCBob2xkcyBhbGwgaGFiaXRzYClcblx0XHRcdHJldHVybiBudWxsXG5cdFx0fVxuXHRcdGNvbnN0IHBhcmVudCA9IHRoaXMuc2V0dGluZ3MuaGFiaXRzR29IZXJlXG5cblx0XHRjb25zdCBuYW1lID0gcGF0aC5zcGxpdCgnLycpLnBvcCgpPy5yZXBsYWNlKCcubWQnLCAnJylcblxuXHRcdC8vIG5vLiB0aGlzIG5lZWRzIHRvIGJlIHF1ZXJpZWQgaW5zaWRlIHRoaXMuc2V0dGluZ3Mucm9vdEVsZW1lbnQ7XG5cdFx0bGV0IHJvdyA9IHBhcmVudC5xdWVyeVNlbGVjdG9yKGAqW2RhdGEtaWQ9XCIke3RoaXMucGF0aFRvSWQocGF0aCl9XCJdYClcblxuXHRcdGlmICghcm93KSB7XG5cdFx0XHRyb3cgPSB0aGlzLnNldHRpbmdzLmhhYml0c0dvSGVyZS5jcmVhdGVFbCgnZGl2Jywge1xuXHRcdFx0XHRjbHM6ICdoYWJpdC10cmFja2VyX19yb3cnLFxuXHRcdFx0fSlcblx0XHRcdHJvdy5zZXRBdHRyaWJ1dGUoJ2RhdGEtaWQnLCB0aGlzLnBhdGhUb0lkKHBhdGgpKVxuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnJlbW92ZUFsbENoaWxkTm9kZXMocm93KVxuXHRcdH1cblxuXHRcdGNvbnN0IGhhYml0VGl0bGUgPSByb3cuY3JlYXRlRWwoJ2RpdicsIHtcblx0XHRcdGNsczogJ2hhYml0LXRyYWNrZXJfX2NlbGwtLW5hbWUgaGFiaXQtdHJhY2tlcl9fY2VsbCcsXG5cdFx0fSlcblxuXHRcdGNvbnN0IGhhYml0VGl0bGVMaW5rID0gaGFiaXRUaXRsZS5jcmVhdGVFbCgnYScsIHtcblx0XHRcdHRleHQ6IG5hbWUsXG5cdFx0XHRjbHM6ICdpbnRlcm5hbC1saW5rJyxcblx0XHR9KVxuXG5cdFx0aGFiaXRUaXRsZUxpbmsuc2V0QXR0cmlidXRlKCdocmVmJywgcGF0aClcblx0XHRoYWJpdFRpdGxlTGluay5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBwYXRoKVxuXG5cdFx0Y29uc3QgY3VycmVudERhdGUgPSB0aGlzLmNyZWF0ZURhdGVGcm9tRm9ybWF0KFxuXHRcdFx0dGhpcy5zZXR0aW5ncy5sYXN0RGlzcGxheWVkRGF0ZSxcblx0XHQpXG5cdFx0Y3VycmVudERhdGUuc2V0RGF0ZShjdXJyZW50RGF0ZS5nZXREYXRlKCkgLSB0aGlzLnNldHRpbmdzLmRheXNUb0xvYWQgKyAxKSAvLyB0b2RvLCB3aHkgKzE/XG5cblx0XHRjb25zdCBlbnRyaWVzU2V0ID0gbmV3IFNldChlbnRyaWVzKVxuXG5cdFx0Ly8gY29uc29sZS5sb2coJ2VudHJpZXMnLCBlbnRyaWVzKTtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuc2V0dGluZ3MuZGF5c1RvTG9hZDsgaSsrKSB7XG5cdFx0XHRjb25zdCBkYXRlU3RyaW5nID0gdGhpcy5nZXREYXRlSWQoY3VycmVudERhdGUpXG5cdFx0XHRjb25zdCBpc1RpY2tlZCA9IGVudHJpZXNTZXQuaGFzKGRhdGVTdHJpbmcpXG5cblx0XHRcdGNvbnN0IGhhYml0Q2VsbCA9IHJvdy5jcmVhdGVFbCgnZGl2Jywge1xuXHRcdFx0XHRjbHM6IGBoYWJpdC10cmFja2VyX19jZWxsXG5cdFx0XHRcdGhhYml0LXRpY2sgaGFiaXQtdGljay0tJHtpc1RpY2tlZH1cblx0XHRcdFx0aGFiaXQtdHJhY2tlcl9fY2VsbC0tJHt0aGlzLmdldERheU9mV2VlayhjdXJyZW50RGF0ZSl9YCxcblx0XHRcdH0pXG5cblx0XHRcdGhhYml0Q2VsbC5zZXRBdHRyaWJ1dGUoJ3RpY2tlZCcsIGlzVGlja2VkLnRvU3RyaW5nKCkpXG5cblx0XHRcdGhhYml0Q2VsbC5zZXRBdHRyaWJ1dGUoJ2RhdGUnLCBkYXRlU3RyaW5nKVxuXHRcdFx0aGFiaXRDZWxsLnNldEF0dHJpYnV0ZSgnaGFiaXQnLCBwYXRoKVxuXG5cdFx0XHRoYWJpdENlbGwuc2V0QXR0cmlidXRlKCdzdHJlYWsnLCB0aGlzLmZpbmRTdHJlYWsoZW50cmllcywgY3VycmVudERhdGUpKVxuXG5cdFx0XHRjdXJyZW50RGF0ZS5zZXREYXRlKGN1cnJlbnREYXRlLmdldERhdGUoKSArIDEpXG5cdFx0fVxuXHR9XG5cblx0Ly8gZ2V0IHN0cmVha1xuXHQvLyBiYXNlZCBvbiBhbiBhcnJheSBvZiBkYXRlcywgZ2V0IHRoZSBjdXJyZW50IHN0cmVhayBmb3IgdGhlIGdpdmVuIGRhdGVcblx0ZmluZFN0cmVhayhlbnRyaWVzLCBkYXRlKSB7XG5cdFx0bGV0IGN1cnJlbnREYXRlID0gbmV3IERhdGUoZGF0ZSk7XG5cdFx0bGV0IHN0cmVhayA9IDBcblxuXHRcdC8vIGNvbnNvbGUubG9nKCdlbnRyaWVzJywgZW50cmllcylcblx0XHQvLyBjb25zb2xlLmxvZygnZGF0ZScsIGRhdGUpXG5cblx0XHR3aGlsZSAoZW50cmllcy5pbmNsdWRlcyh0aGlzLmdldERhdGVJZChjdXJyZW50RGF0ZSkpKSB7XG5cdFx0XHRzdHJlYWsrK1xuXHRcdFx0Y3VycmVudERhdGUuc2V0RGF0ZShjdXJyZW50RGF0ZS5nZXREYXRlKCkgLSAxKVxuXHRcdH1cblxuXHRcdHJldHVybiBzdHJlYWsudG9TdHJpbmcoKTtcblx0fVxuXG5cdGFzeW5jIHRvZ2dsZUhhYml0KGVsKSB7XG5cdFx0Y29uc3QgaGFiaXQgPSBlbC5nZXRBdHRyaWJ1dGUoJ2hhYml0Jylcblx0XHRjb25zdCBkYXRlID0gZWwuZ2V0QXR0cmlidXRlKCdkYXRlJylcblx0XHRjb25zdCBmaWxlOiBUQWJzdHJhY3RGaWxlfG51bGwgPSB0aGlzLmFwcC52YXVsdC5nZXRBYnN0cmFjdEZpbGVCeVBhdGgoaGFiaXQpXG5cdFx0Y29uc3QgaXNUaWNrZWQgPSBlbC5nZXRBdHRyaWJ1dGUoJ3RpY2tlZCcpXG5cblx0XHRpZiAoIWZpbGUgfHwhKGZpbGUgaW5zdGFuY2VvZiBURmlsZSkpIHtcblx0XHRcdG5ldyBOb3RpY2UoYCR7UExVR0lOX05BTUV9OiBmaWxlIG1pc3Npbmcgd2hpbGUgdHJ5aW5nIHRvIHRvZ2dsZSBoYWJpdGApXG5cdFx0XHRyZXR1cm5cblx0XHR9XG5cblx0XHR0aGlzLmFwcC5maWxlTWFuYWdlci5wcm9jZXNzRnJvbnRNYXR0ZXIoZmlsZSwgKGZyb250bWF0dGVyKSA9PiB7XG5cdFx0XHRsZXQgZW50cmllcyA9IGZyb250bWF0dGVyWydlbnRyaWVzJ10gfHwgW11cblx0XHRcdGlmIChpc1RpY2tlZCA9PT0gJ3RydWUnKSB7XG5cdFx0XHRcdGVudHJpZXMgPSBlbnRyaWVzLmZpbHRlcigoZSkgPT4gZSAhPT0gZGF0ZSlcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGVudHJpZXMucHVzaChkYXRlKVxuXHRcdFx0XHRlbnRyaWVzLnNvcnQoKVxuXHRcdFx0fVxuXHRcdFx0ZnJvbnRtYXR0ZXJbJ2VudHJpZXMnXSA9IGVudHJpZXNcblx0XHR9KVxuXG5cdFx0dGhpcy5yZW5kZXJIYWJpdChmaWxlLnBhdGgsIGF3YWl0IHRoaXMuZ2V0SGFiaXRFbnRyaWVzKGZpbGUucGF0aCkpXG5cdH1cblxuXHR3cml0ZUZpbGUoZmlsZTogVEFic3RyYWN0RmlsZSwgY29udGVudDogc3RyaW5nKSB7XG5cdFx0aWYgKCFjb250ZW50KSB7XG5cdFx0XHRuZXcgTm90aWNlKFxuXHRcdFx0XHRgJHtQTFVHSU5fTkFNRX06IGNvdWxkIG5vdCBzYXZlIGNoYW5nZXMgZHVlIHRvIG1pc3NpbmcgY29udGVudGAsXG5cdFx0XHQpXG5cdFx0XHRyZXR1cm4gbnVsbFxuXHRcdH1cblxuXHRcdGlmICghZmlsZSB8fCEoZmlsZSBpbnN0YW5jZW9mIFRGaWxlKSkge1xuXHRcdFx0bmV3IE5vdGljZShcblx0XHRcdFx0YCR7UExVR0lOX05BTUV9OiBjb3VsZCBub3Qgc2F2ZSBjaGFuZ2VzIGR1ZSB0byBtaXNzaW5nIGZpbGVgLFxuXHRcdFx0KVxuXHRcdFx0cmV0dXJuIG51bGxcblx0XHR9XG5cblx0XHR0cnkge1xuXHRcdFx0cmV0dXJuIHRoaXMuYXBwLnZhdWx0Lm1vZGlmeShmaWxlLCBjb250ZW50KVxuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRuZXcgTm90aWNlKGAke1BMVUdJTl9OQU1FfTogY291bGQgbm90IHNhdmUgY2hhbmdlc2ApXG5cdFx0XHRyZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpXG5cdFx0fVxuXHR9XG5cblx0cmVtb3ZlQWxsQ2hpbGROb2RlcyhwYXJlbnQpIHtcblx0XHR3aGlsZSAocGFyZW50LmZpcnN0Q2hpbGQpIHtcblx0XHRcdHBhcmVudC5yZW1vdmVDaGlsZChwYXJlbnQuZmlyc3RDaGlsZClcblx0XHR9XG5cdH1cblxuXHRwYXRoVG9JZChwYXRoKSB7XG5cdFx0cmV0dXJuIHBhdGhcblx0XHRcdC5yZXBsYWNlQWxsKCcvJywgJ18nKVxuXHRcdFx0LnJlcGxhY2VBbGwoJy4nLCAnX18nKVxuXHRcdFx0LnJlcGxhY2VBbGwoJyAnLCAnX19fJylcblx0fVxuXG5cdGNyZWF0ZURhdGVGcm9tRm9ybWF0KGRhdGVTdHJpbmcpIHtcblx0XHRjb25zdCBbeWVhciwgbW9udGgsIGRheV0gPSBkYXRlU3RyaW5nLnNwbGl0KCctJykubWFwKE51bWJlcilcblx0XHRjb25zdCBkYXRlID0gbmV3IERhdGUoKVxuXG5cdFx0ZGF0ZS5zZXRGdWxsWWVhcih5ZWFyKVxuXHRcdGRhdGUuc2V0TW9udGgobW9udGggLSAxKVxuXHRcdGRhdGUuc2V0RGF0ZShkYXkpXG5cblx0XHRyZXR1cm4gZGF0ZVxuXHR9XG5cblx0Z2V0RGF0ZUlkKGRhdGUpIHtcblx0XHRjb25zdCB5ZWFyID0gZGF0ZS5nZXRGdWxsWWVhcigpXG5cdFx0Y29uc3QgbW9udGggPSBTdHJpbmcoZGF0ZS5nZXRNb250aCgpICsgMSkucGFkU3RhcnQoMiwgJzAnKVxuXHRcdGNvbnN0IGRheSA9IFN0cmluZyhkYXRlLmdldERhdGUoKSkucGFkU3RhcnQoMiwgJzAnKVxuXG5cdFx0bGV0IGRhdGVJZCA9IGAke3llYXJ9LSR7bW9udGh9LSR7ZGF5fWBcblxuXHRcdHJldHVybiBkYXRlSWRcblx0fVxuXG5cdGdldERheU9mV2VlayhkYXRlKSB7XG5cdFx0Y29uc3QgZGF5c09mV2VlayA9IFtcblx0XHRcdCdzdW5kYXknLFxuXHRcdFx0J21vbmRheScsXG5cdFx0XHQndHVlc2RheScsXG5cdFx0XHQnd2VkbmVzZGF5Jyxcblx0XHRcdCd0aHVyc2RheScsXG5cdFx0XHQnZnJpZGF5Jyxcblx0XHRcdCdzYXR1cmRheScsXG5cdFx0XVxuXHRcdGNvbnN0IGRheUluZGV4ID0gZGF0ZS5nZXREYXkoKVxuXHRcdGNvbnN0IGRheU5hbWUgPSBkYXlzT2ZXZWVrW2RheUluZGV4XVxuXHRcdHJldHVybiBkYXlOYW1lLnRvTG93ZXJDYXNlKClcblx0fVxuXG5cdGdlbmVyYXRlVW5pcXVlSWQoKSB7XG5cdFx0Y29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKVxuXHRcdGNvbnN0IHJhbmRvbU51bSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwKSAvLyBBZGp1c3QgdGhlIHJhbmdlIGFzIG5lZWRlZFxuXHRcdHJldHVybiBgaGFiaXR0cmFja2VyLSR7dGltZXN0YW1wfS0ke3JhbmRvbU51bX1gXG5cdH1cbn1cbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxJQUFBQSxtQkFBcUI7OztBQ1FyQixzQkFBMkQ7QUFFM0QsSUFBTSxjQUFjO0FBR3BCLElBQU0sZUFBZTtBQUNyQixJQUFNLGVBQWUsZUFBZTtBQVlwQyxJQUFNLG1CQUFtQixPQUE2QjtBQUFBLEVBQ3JELE1BQU07QUFBQSxFQUNOLG1CQUFtQixhQUFhO0FBQUEsRUFDaEMsWUFBWTtBQUFBLEVBQ1osWUFBWTtBQUFBLEVBQ1osYUFBYTtBQUFBLEVBQ2IsY0FBYztBQUFBLEVBQ2QsT0FBTztBQUNSO0FBRUEsSUFBTSx3QkFBd0IsQ0FBQyxRQUFRLHFCQUFxQixjQUFjLE9BQU87QUFFakYsU0FBUyxlQUFlO0FBQ3ZCLFFBQU0sUUFBUSxJQUFJLEtBQUs7QUFDdkIsUUFBTSxPQUFPLE1BQU0sWUFBWTtBQUMvQixRQUFNLFFBQVEsT0FBTyxNQUFNLFNBQVMsSUFBSSxDQUFDLEVBQUUsU0FBUyxHQUFHLEdBQUc7QUFDMUQsUUFBTSxNQUFNLE9BQU8sTUFBTSxRQUFRLENBQUMsRUFBRSxTQUFTLEdBQUcsR0FBRztBQUVuRCxTQUFPLEdBQUcsUUFBUSxTQUFTO0FBQzVCO0FBYUEsSUFBcUIsZUFBckIsTUFBa0M7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
